<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marksheet Generator for Multiple Students</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Times+New+Roman&display=swap");
    @import url("https://fonts.googleapis.com/css2?family=Arial:wght@700&display=swap");
    body {
      font-family: "Times New Roman", serif;
    }
    .marksheet {
      page-break-after: always;
      margin-bottom: 40px;
      position: relative;
      border: 1px solid #1e40af; /* blue-700 */
      padding: 1rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      background-color: white;
      /* --- WATERMARK CSS START --- */
      /* School Seal Watermark URL यहाँ डालें */
      background-image: url('https://placehold.co/400x400/87CEEB/FFFFFF/png?text=SCHOOL+SEAL&font=times+new+roman'); 
      background-repeat: no-repeat;
      background-position: center;
      background-size: 50%; /* Watermark size */
      background-color: white;
      /* --- WATERMARK CSS END --- */
    }
    .marksheet::before {
        /* Watermark Opacity - Ensure text is readable */
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        /* Re-apply the background image here with opacity for better PDF rendering */
        background-image: url('https://placehold.co/400x400/87CEEB/FFFFFF/png?text=SCHOOL+SEAL&font=times+new+roman');
        background-repeat: no-repeat;
        background-position: center;
        background-size: 50%;
        opacity: 0.1; /* Low opacity for watermark effect */
        z-index: 0;
    }
    .logo {
      /* ये वेरिएबल्स आपको JS में ओवरराइड करने की अनुमति देते हैं */
  --logo-top: -3.5rem;   /* Default position */
  --logo-left: 0.5rem;  /* Default position */

  position: absolute;
  top: var(--logo-top);
  left: var(--logo-left);
  z-index: 10; /* Watermark से ऊपर रखने के लिए */

  width: 80px;
  height: 80px;
  object-fit: contain;
    }
	  
    .marksheet > * {
        position: relative;
        z-index: 10; /* Ensure all content is above the watermark */
    }
    .photo {
      max-width: 100px;
      max-height: 120px;
      object-fit: contain;
      border: 1px solid #1e40af;
      border-radius: 4px;
    }
    .grade-f {
      color: #dc2626; /* red-600 */
      font-weight: 700;
    }
    @media print {
      body {
        background: white;
      }
      .marksheet {
        page-break-after: always;
        box-shadow: none;
        border: 1px solid #1e40af;
      }
    }
    #downloadPdfBtn {
      max-width: 900px;
      margin: 1rem auto 2rem auto;
      background-color: #1e40af;
      color: white;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: block;
      text-align: center;
    }
    #downloadPdfBtn:hover {
      background-color: #1e3a8a;
    }

    /* .marksheet background-image code removed as replaced by ::before for better PDF */

    /* Make NAME, DOB, FATHER'S NAME, MOTHER'S NAME, STUDENT'S ADDRESS text Arial Bold */
    .arial-bold {
      font-family: Arial, sans-serif;
      font-weight: 700;
    }
  </style>
</head>
<body class="bg-white p-4 flex flex-col items-center min-h-screen">
  <div class="max-w-md w-full border border-blue-700 p-6 rounded shadow-md mb-6">
    <h1 class="text-center text-blue-800 font-bold text-xl mb-4 underline tracking-wide">
      Download Excel Template for Marksheet Data
    </h1>
    <p class="mb-4 text-sm text-gray-700">
      Download the Excel template below. Fill student data in this format and upload the file to generate marksheets for all students.
    </p>
    <button
      id="downloadTemplateBtn"
      class="w-full bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 rounded"
    >
      Download Excel Template
    </button>
  </div>

  <div id="marksheets-container" class="w-full"></div>

  <button id="downloadPdfBtn" class="hidden">
    <i class="fas fa-file-pdf mr-2"></i>Download All Marksheet(s) as PDF
  </button>

  <div class="max-w-md w-full border border-blue-700 p-6 rounded shadow-md mt-6">
    <h2 class="text-center text-blue-800 font-bold text-lg mb-4 underline tracking-wide">
      Upload Excel File (.xlsx) with Student Data
    </h2>
    <input
      type="file"
      id="fileInput"
      accept=".xlsx, .xls"
      class="block w-full border border-gray-300 rounded p-2 cursor-pointer"
    />
    <p class="text-xs text-gray-600 mt-2">
      Excel columns must be: ROLL No., PEN No., NAME, FATHER'S NAME, MOTHER'S NAME, DATE OF BIRTH, CLASS, ENGLISH, PRACTICAL, HINDI, PRACTICAL, MATH, PRACTICAL, SCIENCE, PRACTICAL, SO SCIENCE, PRACTICAL, SANSKRIT,PRACTICAL, STUDENT'S ADDRESS, PHOTO
    </p>
  </div>

  <script>
    const { jsPDF } = window.jspdf;

    // Calculate grade based on marks and fail if marks < 33
    // 33 marks get grade D
    function calculateGrade(marks, isFail) {
      if (isFail) return "F";
      if (marks >= 90) return "A+";
      if (marks >= 80) return "A";
      if (marks >= 70) return "B+";
      if (marks >= 60) return "B";
      if (marks >= 50) return "C";
      if (marks >= 33) return "D";
      return "F";
    }

    // Download Excel template
    document.getElementById("downloadTemplateBtn").addEventListener("click", () => {
      const wb = XLSX.utils.book_new();
      const ws_data = [
        [
          "ROLL No.",
          "PEN No.",
          "NAME",
          "FATHER'S NAME",
          "MOTHER'S NAME",
          "DATE OF BIRTH",
          "CLASS",
          "ENGLISH",
          "PRACTICAL",
          "HINDI",
          "PRACTICAL",
          "MATH",
          "PRACTICAL",
          "SCIENCE",
          "PRACTICAL",
          "SO SCIENCE",
          "PRACTICAL",
          "SANSKRIT",
	 "PRACTICAL",
          "STUDENT'S ADDRESS",
          "PHOTO",
        ],
        [
          3,
          "21452545522",
          "SUSMITA JOJO",
          "RAJU SINGHI",
          "REEMA DEV",
          "12.8.2008",
          "140028",
          37,
          20,
          58,
          20,
          33,
          20,
          33,
          20,
          72,
          20,
          78,
	  20,
          "SIMDEGA, SALDEGA, JHJARKHAND 835223",
          "student image",
        ],
        [
          4,
          "21452545522",
          "BINDU KUMARI",
          "RAJU SINGHI",
          "REEMA DEV",
          "12.8.2009",
          "140028",
          40,
          15,
          55,
          15,
          35,
          15,
          35,
          15,
          87,
          15,
          56,
          15,
          "SIMDEGA, SALDEGA, JHJARKHAND 835224",
          " student image",
        ],
      ];
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      ws["!cols"] = [
        { wch: 10 },
        { wch: 15 },
        { wch: 20 },
        { wch: 20 },
        { wch: 20 },
        { wch: 15 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 10 },
        { wch: 40 },
        { wch: 30 },
      ];
      XLSX.utils.book_append_sheet(wb, ws, "Students");
      XLSX.writeFile(wb, "Marksheet_Student_Template.xlsx");
    });

    // Escape HTML to prevent injection
    function escapeHtml(text) {
      if (!text) return "";
      return text
        .toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Check if marks is pass or fail based on pass mark 33
    function isPass(marks) {
      return marks >= 33;
    }

    // Generate marksheet HTML for one student
    function generateMarksheetHTML(student) {
      // Subjects with theory and practical columns
      const subjects = [
        { id: "english", name: "LANG-2 : ENGLISH", theoryCol: "ENGLISH", practicalCol: "PRACTICAL" },
        { id: "hindi", name: "LANG-1: HINDI-A", theoryCol: "HINDI", practicalCol: "PRACTICAL_1" },
        { id: "math", name: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATHMATICS", theoryCol: "MATH", practicalCol: "PRACTICAL_2" },
        { id: "science", name: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCIENCE", theoryCol: "SCIENCE", practicalCol: "PRACTICAL_3" },
        { id: "sst", name: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.O SCIENCE", theoryCol: "SO SCIENCE", practicalCol: "PRACTICAL_4" },
        { id: "sanskrit", name: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SANSKRIT", theoryCol: "SANSKRIT", practicalCol:"PRACTICAL_5" },
      ];

      // Because the Excel columns have multiple PRACTICAL columns, we need to map them correctly.
      // The input columns are:
      // ENGLISH, PRACTICAL, HINDI, PRACTICAL, MATH, PRACTICAL, SCIENCE, PRACTICAL, SO SCIENCE, PRACTICAL, SANSKRIT, PRACTICAL
      // So PRACTICAL columns repeat after each theory except Sanskrit which has no practical.
      // We'll assign PRACTICAL columns as PRACTICAL, PRACTICAL_1, PRACTICAL_2, PRACTICAL_3, PRACTICAL_4, PRACTICAL_5 in order.

      // Extract practical columns from student object by order:
      // We'll create a helper array of practical column names in order:
      const practicalColsOrder = ["PRACTICAL", "PRACTICAL_1", "PRACTICAL_2", "PRACTICAL_3", "PRACTICAL_4","PRACTICAL_5"];

      // We need to remap the student object keys to handle multiple PRACTICAL columns.
      // Since XLSX converts columns with same name to unique keys by appending suffixes, we must detect them.
      // Let's find all keys starting with "PRACTICAL" and map them in order.

      // Get all keys from student object
      const keys = Object.keys(student);
      // Filter keys starting with "PRACTICAL"
      const practicalKeys = keys.filter(k => k.toUpperCase().startsWith("PRACTICAL"));

      // Map practicalColsOrder to actual keys found in student
      const practicalKeyMap = {};
      for(let i=0; i<practicalColsOrder.length; i++) {
        if(i < practicalKeys.length) {
          practicalKeyMap[practicalColsOrder[i]] = practicalKeys[i];
        } else {
          practicalKeyMap[practicalColsOrder[i]] = null;
        }
      }

      let totalMarks = 0;
      const maxTotal = subjects.length * 100 + 5 * 20; // 6 subjects theory max 100 each, 5 practical max 20 each (assuming 20 max practical)
      let anyFail = false;

      // We'll build rows with columns: SUBJECT | FULL MARKS | THEORY MARKS | PRACTICAL MARKS | TOTAL MARKS | GRADE

      // Full marks: theory 80, practical 20 (assumed), total 100 for subjects with practical, 100 for Sanskrit

      const rows = subjects.map(({ id, name, theoryCol, practicalCol }, index) => {
        const theoryMarks = Number(student[theoryCol]) || 0;
        let practicalMarks = 0;
        if(practicalCol) {
          const key = practicalKeyMap[practicalCol];
          practicalMarks = key ? Number(student[key]) || 0 : 0;
        }
        const totalSubjectMarks = theoryMarks + practicalMarks;
        totalMarks += totalSubjectMarks;

        // Fail if theory < 33 or total < 33 (assuming pass mark 33 for theory and total)
        const failSubject = theoryMarks < 33 || totalSubjectMarks < 33;
        if (failSubject) anyFail = true;

        const grade = calculateGrade(totalSubjectMarks, failSubject);
        const gradeClass = grade === "F" ? "grade-f" : "";

        // Full marks: theory 80, practical 20 if practical exists, total accordingly
        const fullTheory = 80;
        const fullPractical = practicalCol ? 20 : 0;
        const fullTotal = fullTheory + fullPractical;

        return `
          <tr>
            <td class="border border-blue-700 px-1 py-0.5 font-bold">${name}</td>
            <td class="border border-blue-700 px-1 py-0.5 text-center">${fullTheory}</td>
            <td class="border border-blue-700 px-1 py-0.5 text-center">${theoryMarks}</td>
            <td class="border border-blue-700 px-1 py-0.5 text-center">${fullPractical > 0 ? fullPractical : "-"}</td>
            <td class="border border-blue-700 px-1 py-0.5 text-center">${fullPractical > 0 ? practicalMarks : "-"}</td>
            <td class="border border-blue-700 px-1 py-0.5 text-center font-bold">${totalSubjectMarks}</td>
            <td class="border border-blue-700 px-1 py-0.5 text-center font-bold ${gradeClass}">${grade}</td>
          </tr>
        `;
      }).join("");

      const percentage = ((totalMarks / maxTotal) * 100).toFixed(2);
      const resultText = (!anyFail && percentage >= 40) ? "Pass" : "Fail";
      const overallGrade = !anyFail ? calculateGrade(percentage, false) : "F";
      const overallGradeClass = overallGrade === "F" ? "grade-f" : "";

      // Photo src fallback to placeholder if empty
      let photoSrc = "";
      if (student["PHOTO"]) {
        // Clean up path for URL usage
        photoSrc = escapeHtml(student["PHOTO"]).replace(/\\/g, "/").replace(/ /g, "%20");
      }
      if (!photoSrc) {
        photoSrc = "https://placehold.co/100x120/png?text=No+Photo&font=times+new+roman";
      }

      return `
      <div class="marksheet" style="page-break-after: always;">

        <img src="https://github.com/jokbaharh/School_Management_System/blob/main/image/LOGO.png?raw=true"
          alt="Circular school logo with text and emblem in red"
          class="logo"
          width="80"
          height="80"
        />
        <div class="text-center mt-2 mb-2">
          <h1 class="text-blue-800 font-bold text-lg underline tracking-wide">
            PROPOSSED HIGH SCHOOL, JOKBAHAR, SIMDEGA
          </h1>
          <h2 class="text-blue-800 text-sm font-semibold tracking-wide">
            VII ANNUAL EXAMINATION (2023-24)
          </h2>
          <h3 class="text-blue-800 text-sm font-semibold tracking-wide">
            MARKSHEET - 2024
          </h3>
        </div>
        <div class="flex flex-col md:flex-row justify-between items-center mt-2 mb-4 gap-4">
          <div class="flex-1">
            <table cellpadding="0" cellspacing="0" class="w-full border border-blue-700 text-[10px] text-blue-900">
              <tbody>
                <tr>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  " style="min-width: 70px">Roll Code :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" style="min-width: 70px">${escapeHtml(student.CLASS)}</td>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  " style="min-width: 70px">Roll No :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" style="min-width: 70px">${escapeHtml(student["ROLL No."])}</td>
                  <th class="border border-blue-700 px-1 py-0.5 text-left" style="min-width: 90px">PEN No :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" style="min-width: 90px">${escapeHtml(student["PEN No."])}</td>
                </tr>
                <tr>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  bold" style="min-width: 70px">Student's Name :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" colspan="3" style="min-width: 250px">${escapeHtml(student.NAME)}</td>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  " style="min-width: 70px">Date of Birth :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" style="min-width: 90px">${escapeHtml(student["DATE OF BIRTH"])}</td>
                </tr>
                <tr>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  " style="min-width: 70px">Mother's Name :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" colspan="3" style="min-width: 250px">${escapeHtml(student["MOTHER'S NAME"])}</td>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  " style="min-width: 70px">Father's Name :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" style="min-width: 90px">${escapeHtml(student["FATHER'S NAME"])}</td>
                </tr>
                <tr>
                  <th class="border border-blue-700 px-1 py-0.5 text-left  " style="min-width: 70px">Student's Address :</th>
                  <td class="border border-blue-700 px-1 py-0.5 text-left arial-bold" colspan="5" style="min-width: 350px">${escapeHtml(student["STUDENT'S ADDRESS"] || "")}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="flex-shrink-0">
            <img src="${photoSrc}" alt="Photo of student ${escapeHtml(student.NAME)}" class="photo" width="100" height="120" />
          </div>
        </div>
        <div class="overflow-x-auto">
          <table cellpadding="0" cellspacing="0" class="w-full border border-blue-700 text-[10px] text-blue-900">
            <thead>
              <tr class="bg-blue-100 text-blue-900 font-bold text-[11px]">
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[120px]">SUBJECT</th>
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[60px]">FULL MARKS (Theory)</th>
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[60px]">OBTAINED (Theory)</th>
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[60px]">FULL MARKS (Practical)</th>
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[60px]">OBTAINED (Practical)</th>
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[60px]">TOTAL MARKS</th>
                <th class="border border-blue-700 px-1 py-0.5 text-center w-[60px]">GRADE</th>
              </tr>
            </thead>
            <tbody class="text-blue-900 font-semibold text-[10px]">
              ${rows}
              <tr>
                <td class="border border-blue-700 px-1 py-0.5 font-bold" colspan="5">Total Marks :</td>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold">${totalMarks}</td>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold"></td>
              </tr>
              <tr>
                <td class="border border-blue-700 px-1 py-0.5 font-bold" colspan="5">Result :</td>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold">${resultText}</td>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold"></td>
              </tr>
              <tr>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold" colspan="5">Percentage :</td>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold">${percentage}%</td>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold"></td>
              </tr>
              <tr>
                <td class="border border-blue-700 px-1 py-0.5 text-center font-bold ${overallGradeClass}" colspan="7">Grade : ${overallGrade}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="flex justify-between mt-6 text-[10px] text-blue-900 font-semibold px-2">
          <div class="text-center w-1/3">Class Teacher's Sign</div>
          <div class="text-center w-1/3">Secretary's Sign</div>
          <div class="text-center w-1/3">Head's Sign &amp; Verified by Stamp</div>
        </div>
      </div>
      `;
    }

    // Handle file upload and generate marksheets for all students
    const container = document.getElementById("marksheets-container");
    const downloadPdfBtn = document.getElementById("downloadPdfBtn");

    document.getElementById("fileInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (evt) => {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, { type: "array" });

        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

        if (jsonData.length === 0) {
          alert("Excel file is empty or format is incorrect.");
          return;
        }

        // Required columns
        const requiredFields = [
          "ROLL No.",
          "PEN No.",
          "NAME",
          "FATHER'S NAME",
          "MOTHER'S NAME",
          "DATE OF BIRTH",
          "CLASS",
          "ENGLISH",
          "PRACTICAL",
          "HINDI",
          "PRACTICAL_1",
          "MATH",
          "PRACTICAL_2",
          "SCIENCE",
          "PRACTICAL_3",
          "SO SCIENCE",
          "PRACTICAL_4",
          "SANSKRIT",
          "STUDENT'S ADDRESS",
          "PHOTO"
        ];

        // Check columns exist in first row
        const firstRow = jsonData[0];
        for (const field of requiredFields) {
          if (!(field in firstRow)) {
            alert(`Missing required column: ${field}`);
            return;
          }
        }

        // Clear previous marksheets
        container.innerHTML = "";

        // Generate marksheet for each student
        jsonData.forEach((student) => {
          const marksheetHTML = generateMarksheetHTML(student);
          const div = document.createElement("div");
          div.innerHTML = marksheetHTML;
          container.appendChild(div.firstElementChild);
        });

        downloadPdfBtn.classList.remove("hidden");
        downloadPdfBtn.scrollIntoView({ behavior: "smooth" });
      };
      reader.readAsArrayBuffer(file);
    });

    // PDF generation for all marksheets, one per page
    downloadPdfBtn.addEventListener("click", async () => {
      const marksheets = container.querySelectorAll(".marksheet");
      if (marksheets.length === 0) {
        alert("No marksheets to download.");
        return;
      }

      const pdf = new jsPDF({
        unit: "pt",
        format: "a4",
        compress: true,
      });

      for (let i = 0; i < marksheets.length; i++) {
        const marksheet = marksheets[i];
        // Clone node to avoid modifying original
        const clone = marksheet.cloneNode(true);
        // Remove page-break-after style for html2canvas
        clone.style.pageBreakAfter = "auto";

        // Create container for rendering
        const wrapper = document.createElement("div");
        wrapper.style.width = "794px"; // A4 width in px approx (96dpi)
        wrapper.style.padding = "20px";
        wrapper.style.background = "white";
        wrapper.appendChild(clone);

        document.body.appendChild(wrapper);

        // Use html2canvas to render
        const canvas = await html2canvas(wrapper, {
          scale: 2,
          backgroundColor: "#ffffff",
          useCORS: true,
          scrollX: -window.scrollX,
          scrollY: -window.scrollY,
          windowWidth: document.documentElement.offsetWidth,
          windowHeight: document.documentElement.offsetHeight,
        });

        const imgData = canvas.toDataURL("image/png");
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        if (i > 0) pdf.addPage();
        pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);

        document.body.removeChild(wrapper);
      }

      pdf.save("Marksheet_Students.pdf");
    });
  </script>
</body>
</html>







